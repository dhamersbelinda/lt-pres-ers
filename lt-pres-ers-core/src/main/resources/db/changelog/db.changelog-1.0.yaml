databaseChangeLog:

  - changeSet:
      id: 1
      author: nowina
      changes:
        - createTable:
            tableName: PROFILE
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_PROFILE
                   nullable: false
              - column:
                 name: PROFILE_IDENTIFIER
                 type: varchar(2048)
                 constraints:
                   nullable: false
                   unique: true
                   uniqueConstraintName: UK_PROFILE_IDENTIFIER
              - column:
                 name: PRESERVATION_EVIDENCE_POLICY
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: VALID_FROM
                 type: TIMESTAMP(3)
                 constraints:
                   nullable: false
              - column:
                 name: VALID_UNTIL
                 type: TIMESTAMP(3)
                 constraints:
                   nullable: true
              - column:
                 name: PRESERVATION_STORAGE_MODEL
                 type: varchar(32)
                 constraints:
                   nullable: false
              - column:
                 name: PRESERVATION_GOAL
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: EVIDENCE_FORMAT
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: SCHEME_IDENTIFIER
                 type: varchar(2048)
                 constraints:
                   nullable: true
              - column:
                 name: SPECIFICATION
                 type: varchar(2048)
                 constraints:
                   nullable: true
              - column:
                 name: PRESERVATION_EVIDENCE_RETENTION_PERIOD
                 type: varchar(32)
                 constraints:
                   nullable: true
              - column:
                 name: PRESERVATION_EVIDENCE_RETENTION_DURATION
                 type: varchar(32)
                 constraints:
                   nullable: true

  - changeSet:
      id: 2
      author: nowina
      changes:
        - createTable:
            tableName: OPERATION
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_OPERATION
                   nullable: false
              - column:
                 name: NAME
                 type: varchar(128)
                 constraints:
                   nullable: false
              - column:
                 name: SPECIFICATION
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: DESCRIPTION
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: PROFILE_ID
                 type: BIGINT
                 constraints:
                   nullable: false

  - changeSet:
      id: 3
      author: nowina
      changes:
        - createTable:
            tableName: OPERATION_INPUT
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_OPERATION_INPUT
                   nullable: false
              - column:
                 name: NAME
                 type: varchar(128)
                 constraints:
                   nullable: false
              - column:
                 name: DESCRIPTION
                 type: varchar(2048)
                 constraints:
                   nullable: true
              - column:
                 name: FORMAT_ID
                 type: BIGINT
                 constraints:
                   nullable: true
              - column:
                 name: OPERATION_ID
                 type: BIGINT
                 constraints:
                   nullable: false

  - changeSet:
      id: 4
      author: nowina
      changes:
        - createTable:
            tableName: OPERATION_OUTPUT
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_OPERATION_OUTPUT
                   nullable: false
              - column:
                 name: NAME
                 type: varchar(128)
                 constraints:
                   nullable: false
              - column:
                 name: DESCRIPTION
                 type: varchar(2048)
                 constraints:
                   nullable: false
              - column:
                 name: OPERATION_ID
                 type: BIGINT
                 constraints:
                   nullable: false

  - changeSet:
      id: 5
      author: nowina
      changes:
        - createTable:
            tableName: FORMAT
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_FORMAT
                   nullable: false
              - column:
                 name: FORMAT_ID
                 type: varchar(2048)
                 constraints:
                   nullable: false

  - changeSet:
      id: 6
      author: nowina
      changes:
        - createTable:
            tableName: PARAMETER
            columns:
              - column:
                 name: ID
                 type: BIGINT
                 autoIncrement: true
                 constraints:
                   primaryKey: true
                   primaryKeyName: PK_PARAMETER
                   nullable: false
              - column:
                 name: PARENT_FORMAT_ID
                 type: BIGINT
                 constraints:
                   nullable: false
              - column:
                 name: FORMAT_ID
                 type: BIGINT
                 constraints:
                   nullable: false

  - changeSet:
      id: 7
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: PROFILE_ID
            baseTableName: OPERATION
            constraintName: FK_OPERATION_PROFILE
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: PROFILE
            validate: true

  - changeSet:
      id: 8
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: FORMAT_ID
            baseTableName: OPERATION_INPUT
            constraintName: FK_OPERATION_INPUT_FORMAT
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: FORMAT
            validate: true

  - changeSet:
      id: 9
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: OPERATION_ID
            baseTableName: OPERATION_INPUT
            constraintName: FK_OPERATION_INPUT_OPERATION
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: OPERATION
            validate: true

  - changeSet:
      id: 10
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: OPERATION_ID
            baseTableName: OPERATION_OUTPUT
            constraintName: FK_OPERATION_OUTPUT_OPERATION
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: OPERATION
            validate: true

  - changeSet:
      id: 11
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: PARENT_FORMAT_ID
            baseTableName: PARAMETER
            constraintName: FK_PARAMETER_PARENT_FORMAT
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: FORMAT
            validate: true

  - changeSet:
      id: 12
      author: nowina
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: FORMAT_ID
            baseTableName: PARAMETER
            constraintName: FK_PARAMETER_FORMAT
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: FORMAT
            validate: true

  - changeSet:
     id: 13
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: PROFILE_IDENTIFIER  
                 value: https://uclouvain.be/en/faculties/epl/preservation-api/profile/v1.0
             - column:
                 name: PRESERVATION_EVIDENCE_POLICY  
                 value: https://uclouvain.be/en/faculties/epl/preservation-api/profile/preservation-evidence-policy/v1.0
             - column:
                 name: VALID_FROM
                 valueDate: 2022-10-01
             - column:
                 name: PRESERVATION_STORAGE_MODEL  
                 value: WITH_TEMPORARY_STORAGE
             - column:
                 name: PRESERVATION_GOAL  
                 value: http://uri.etsi.org/19512/goal/pgd
             - column:
                 name: EVIDENCE_FORMAT  
                 value: urn:ietf:rfc:6283 
             - column:
                 name: SCHEME_IDENTIFIER  
                 value: http://uri.etsi.org/19512/scheme/pgd+wts+ers
             - column:
                 name: SPECIFICATION  
                 value: https://www.etsi.org/deliver/etsi_ts/119500_119599/119512/01.01.02_60/ts_119512v010102p.pdf
             - column:
                 name: PRESERVATION_EVIDENCE_RETENTION_PERIOD  
                 value: P10Y
             - column:
                 name: PRESERVATION_EVIDENCE_RETENTION_DURATION  
                 value: PT0S
           tableName: PROFILE
       - rollback:
           - delete:
              tableName: PROFILE

  - changeSet:
     id: 14
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: PreservePO
             - column:
                 name: SPECIFICATION  
                 value: https://www.etsi.org/deliver/etsi_ts/119500_119599/119512/01.01.02_60/ts_119512v010102p.pdf
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.3
             - column:
                 name: PROFILE_ID  
                 valueComputed: (SELECT ID FROM PROFILE)
           tableName: OPERATION
       - rollback:
           - delete:
              tableName: OPERATION

  - changeSet:
     id: 15
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: RetrievePO
             - column:
                 name: SPECIFICATION  
                 value: https://www.etsi.org/deliver/etsi_ts/119500_119599/119512/01.01.02_60/ts_119512v010102p.pdf
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.4
             - column:
                 name: PROFILE_ID  
                 valueComputed: (SELECT ID FROM PROFILE)
           tableName: OPERATION
       - rollback:
           - delete:
              tableName: OPERATION

  - changeSet:
     id: 16
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: FORMAT_ID
                 value: http://uri.etsi.org/19512/format/DigestList
           tableName: FORMAT
       - rollback:
           - delete:
              tableName: FORMAT

  - changeSet:
     id: 17
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: PreservePORequest
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.3.1
             - column:
                 name: FORMAT_ID
                 valueComputed: (SELECT ID FROM FORMAT WHERE FORMAT_ID = 'http://uri.etsi.org/19512/format/DigestList')
             - column:
                 name: OPERATION_ID  
                 valueComputed: (SELECT ID FROM OPERATION WHERE NAME = 'PreservePO')
           tableName: OPERATION_INPUT
       - rollback:
           - delete:
              tableName: OPERATION_INPUT

  - changeSet:
     id: 18
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: RetrievePORequest
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.4.1
             - column:
                 name: OPERATION_ID
                 valueComputed: (SELECT ID FROM OPERATION WHERE NAME = 'RetrievePO')
           tableName: OPERATION_INPUT
       - rollback:
           - delete:
              tableName: OPERATION_INPUT

  - changeSet:
     id: 19
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: PreservePOResponse
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.3.2
             - column:
                 name: OPERATION_ID
                 valueComputed: (SELECT ID FROM OPERATION WHERE NAME = 'PreservePO')
           tableName: OPERATION_OUTPUT
       - rollback:
           - delete:
              tableName: OPERATION_OUTPUT

  - changeSet:
     id: 20
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: NAME  
                 value: RetrievePOResponse
             - column:
                 name: DESCRIPTION
                 value: See clause 5.3.4.2
             - column:
                 name: OPERATION_ID
                 valueComputed: (SELECT ID FROM OPERATION WHERE NAME = 'RetrievePO')
           tableName: OPERATION_OUTPUT
       - rollback:
           - delete:
              tableName: OPERATION_OUTPUT

  - changeSet:
     id: 21
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: FORMAT_ID
                 value: SHA-256
           tableName: FORMAT
       - rollback:
           - delete:
              tableName: FORMAT

  - changeSet:
     id: 22
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: PARENT_FORMAT_ID  
                 valueComputed: (SELECT ID FROM FORMAT WHERE FORMAT_ID = 'http://uri.etsi.org/19512/format/DigestList')
             - column:
                 name: FORMAT_ID  
                 valueComputed: (SELECT ID FROM FORMAT WHERE FORMAT_ID = 'SHA-256')
           tableName: PARAMETER
       - rollback:
           - delete:
              tableName: PARAMETER

  - changeSet:
     id: 23
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: FORMAT_ID
                 value: SHA-512
           tableName: FORMAT
       - rollback:
           - delete:
              tableName: FORMAT

  - changeSet:
     id: 24
     author: nowina
     changes:
       - insert:
           columns:
             - column:
                 name: PARENT_FORMAT_ID  
                 valueComputed: (SELECT ID FROM FORMAT WHERE FORMAT_ID = 'http://uri.etsi.org/19512/format/DigestList')
             - column:
                 name: FORMAT_ID  
                 valueComputed: (SELECT ID FROM FORMAT WHERE FORMAT_ID = 'SHA-512')
           tableName: PARAMETER
       - rollback:
           - delete:
              tableName: PARAMETER

  - changeSet:
      id: 25
      author: belinda
      changes:
        - createTable:
            tableName: PO
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_PO
                    nullable: false
              - column:
                  name: UNIQUE_IDENTIFIER
                  type: varchar(2048)
                  constraints:
                    nullable: true
                    unique: true
                    uniqueConstraintName: UK_PO_IDENTIFIER
              - column:
                  name: PO_VALUE
                  type: varchar(2048)
                  constraints:
                    nullable: false
              - column:
                  name: FORMAT_IDENTIFIER
                  type: varchar(2048)
                  constraints:
                    nullable: false

  - changeSet:
      id: 26
      author: belinda
      changes:
        - createTable:
            tableName: DIGESTLIST
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_DIGESTLIST
                    nullable: false
              - column:
                  name: DIGEST_METHOD
                  type: varchar(2048)
                  constraints:
                    nullable: true
              - column:
                  name: PO_ID
                  type: BIGINT
                  constraints:
                    nullable: true

  - changeSet:
      id: 27
      author: belinda
      changes:
        - createTable:
            tableName: DIGEST
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_DIGEST
                    nullable: false
              - column:
                  name: DIGEST_VALUE
                  type: varchar(2048)
                  constraints:
                    nullable: false
              - column:
                  name: DIGESTLIST_ID
                  type: BIGINT
                  constraints:
                    nullable: true


  #- changeSet:
  #    id: 28
  #    author: belinda
  #    changes:
  #      - addForeignKeyConstraint:
  #          baseColumnNames: DIGESTLIST_ID
  #          baseTableName: PO
  #          constraintName: FK_PO_DIGESTLIST
  #          deferrable: false
  #          initiallyDeferred: false
  #          onDelete: RESTRICT
  #          onUpdate: RESTRICT
  #          referencedColumnNames: ID
  #          referencedTableName: DIGESTLIST
  #          validate: true

  - changeSet:
      id: 29
      author: belinda
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: PO_ID
            baseTableName: DIGESTLIST
            constraintName: FK_DIGESTLIST_PO
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: PO
            validate: true

  - changeSet:
      id: 30
      author: belinda
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: DIGESTLIST_ID
            baseTableName: DIGEST
            constraintName: FK_DIGEST_DIGESTLIST
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: DIGESTLIST
            validate: true

  - changeSet:
      id: 31
      author: bimbambel
      changes:
      - addColumn:
          tableName: PO
          columns:
            - column:
                name: MIMETYPE
                type: varchar(2048)
                constraints:
                  nullable: true
            - column:
                name: PRONOM_ID
                type: varchar(2048)
                constraints:
                  nullable: true
            - column:
                name: REQ_ID
                type: VARCHAR(255)
                constraints:
                  nullable: false
      - dropColumn:
          tableName: PO
          columns:
          - column:
              name: PO_VALUE

  - changeSet:
      id: 32
      author: bimbambel
      changes:
        - createTable:
            tableName: POIDs
            columns:
              - column:
                  name: POID
                  type: VARCHAR(255)
                  #autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_POID
                    nullable: false
              - column:
                  name: PROFILE_ID
                  type: BIGINT
                  #autoIncrement: true
                  constraints:
                    nullable: false
              - column:
                  name: CLIENT_ID
                  type: integer
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: NODE_ID
                  type: BIGINT
                  constraints:
                    nullable: true

  - changeSet:
      id: 33
      author: bimbambel
      changes:
        - createTable:
            tableName: RELATED_OBJECT
            columns:
              - column:
                  name: ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_RELOBJ
                    nullable: false
              - column:
                  name: RELATED_OBJECT_NAME
                  type: varchar(128)
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: PO_ID
                  type: BIGINT
                  constraints:
                    nullable: false

  - changeSet:
      id: 34
      author: bimbambel
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: PO_ID
            baseTableName: RELATED_OBJECT
            constraintName: FK_RELOBJ
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: ID
            referencedTableName: PO
            validate: true


  - changeSet:
      id: 35
      author: bimbambel
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: REQ_ID
            baseTableName: PO
            constraintName: FK_REQ_PO
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: POID
            referencedTableName: POIDs
            validate: true

  - changeSet:
      id: 36
      author: sasha
      changes:
        - createTable:
            tableName: Nodes
            columns:
              - column:
                  name: NODE_ID
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_NODE_ID
                    nullable: false
              - column:
                  name: PARENT_ID
                  type: BIGINT
                  constraints:
                    nullable: true
                    unique: false
              - column:
                  name: NEIGHBOUR_ID
                  type: BIGINT
                  constraints:
                    nullable: true
                    unique: true    # TODO : Here we consider only binary trees
              - column:
                  name: TREE_ID
                  type: BIGINT
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: IN_TREE_ID
                  type: BIGINT
                  constraints:
                    nullable: false
                    unique: false

  - changeSet:
      id: 37
      author: sasha
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: PARENT_ID
            baseTableName: NODES
            constraintName: FK_PARENT_ID
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: NODE_ID
            referencedTableName: NODES
            validate: true

  - changeSet:
      id: 38
      author: sasha
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: NEIGHBOUR_ID
            baseTableName: NODES
            constraintName: FK_NEIGHBOUR_ID
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: NODE_ID
            referencedTableName: NODES
            validate: true

  - changeSet:
      id: 39
      author: sasha
      changes:
        - addUnqiueConstraint:
            columnNames: TREE_ID, IN_TREE_ID
            tableName: NODES
            constraintName: UQ_TREE_ID__IN_TREE_ID
            deferrable: false
            initiallyDeferred: false
            referencedColumnNames: NODE_ID
            referencedTableName: NODES
            validate: true

  - changeSet:
      id: 40
      author: sasha
      changes:
        - createTable:
            tableName: Temporary_records
            columns:
              - column:
                  name: POID
                  type: BINARY(255)
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_POID__DIG_NUM
                    nullable: false
              - column:
                  name: DIG_NUM
                  type: INTEGER
                  constraints:
                    primaryKey: true
                    primaryKeyName: PK_POID__DIG_NUM
                    nullable: false
              - column:
                  name: DIG_METHOD
                  type: VARCHAR(2048)
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: VALUE
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
                    unique: false
              - column:
                  name: CLIENT_ID
                  type: integer
                  constraints:
                    nullable: false
                    unique: false

  - changeSet:
      id: 41
      author: sasha
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: POID
            baseTableName: Temporary_records
            constraintName: FK_POID
            deferrable: false
            initiallyDeferred: false
            onDelete: RESTRICT
            onUpdate: RESTRICT
            referencedColumnNames: POID
            referencedTableName: POIDs
            validate: true
